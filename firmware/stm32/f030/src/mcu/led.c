/////////////////////////////////////////////////////////////////////////
///	\file led.c
///	\brief this is the LED hardware interface layer.
///
///	Author: Alan Ford
/////////////////////////////////////////////////////////////////////////
#include "MCU/led.h"

/////////////////////////////////////////////////////////////////////////
///	\brief defines the LED pin number
/////////////////////////////////////////////////////////////////////////
#define LED_PIN	10

/////////////////////////////////////////////////////////////////////////
///	\brief	Turns on the LED
/////////////////////////////////////////////////////////////////////////
void Led_On(void)
{
	GPIOB->BSRR |= ((uint32_t)1 << LED_PIN);
}

/////////////////////////////////////////////////////////////////////////
///	\brief	Turns off the LED
/////////////////////////////////////////////////////////////////////////
void Led_Off(void)
{
	GPIOB->BRR |= ((uint32_t)1 << LED_PIN);
}

/////////////////////////////////////////////////////////////////////////
/// \brief  Toggle the LED state
/////////////////////////////////////////////////////////////////////////
void Led_Toggle(void)
{
    // read the IO state. if set the turn the led off else turn it on
    if(GPIOB->ODR & (1<<LED_PIN))
    {
        Led_Off();
    }
    else
    {
        Led_On();
    }
}
/////////////////////////////////////////////////////////////////////////
///	\brief	Setup the LED IO
/////////////////////////////////////////////////////////////////////////
void Led_Init(void)
{
	RCC->AHBENR |= ((uint32_t)RCC_AHBENR_GPIOBEN); // enable port B clock

	// configure port
	GPIOB->MODER   &= ~((uint32_t)GPIO_MODER_MODER10);     // clear the related bits before we set them. Comment the next call will set all bits.
	GPIOB->MODER   |=  ((uint32_t)GPIO_MODER_MODER10_0);   // the pin as output
	GPIOB->OTYPER  &= ~((uint32_t)GPIO_OTYPER_OT_10); 	   // set it to push-pull
	GPIOB->OSPEEDR |=  ((uint32_t)GPIO_OSPEEDR_OSPEEDR10); // set to 50Mhz
	GPIOB->PUPDR   &= ~((uint32_t)GPIO_PUPDR_PUPDR10);	   // no pull up/down resistor

	Led_Off();
}
